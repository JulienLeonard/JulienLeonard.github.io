function bpatternbao(b,x,a){this.lastindex=1;this.nodes=x;this.side=b;this.fdraw=a;this.iter=function(a,z){var b,k=this.lastindex,e=this.nodes,g=this.side,n=[],t=lconcat(samples(1,10,30),samples(10,1,30));for(b=0;1E3>b;b++)if(-1<k){var p=rand(.9,1.1),d=e[k];p=2.5*p*rand(.8,1.2)*lcircular(t,e.length);var c=circle(d.x,d.y,d.r+2*p),l=collidings(a,c),h,q=!1;for(h=0;h<l.length;h++)if(d!=l[h]&&.5>l[h].r&&(c=circles2tangent(d,"OUT",l[h],"OUT",p,g),!isNan(c.x)&&!checkcollisionquadtree(a,c))){e.push(c);this.nodess=
e;a.insert(c);this.fdraw(z,this,k);q=!0;n=[c];break}if(!q)for(h=0;h<l.length;h++)if(d!=l[h]&&(c=circles2tangent(d,"OUT",l[h],"OUT",p,g),!isNaN(c.x)&&!checkcollisionquadtree(a,c))){e.push(c);this.nodess=e;n=d3.hsl((k+10)%60/60*360,1,.5);a.insert(c);drawcircle(z,circle(c.x,c.y,c.r),n);q=!0;n=[c];break}this.lastindex=k=q?e.length-1:k-1}return n}}function nodeindex(b){return null==b?null:b.index}function nodex(b){return null==b?null:b.x}function nodey(b){return null==b?null:b.y}
function bpatternbaoswitch(b,x,a,A){this.lastindex=1;this.nodes=a;this.sides=b;a[0].index=0;a[1].index=1;a[0].retouch=!1;a[1].retouch=!1;a[0].notfound=!1;a[1].notfound=!1;a[0].colorindex=0;a[1].colorindex=1;this.lastnode=a[1];this.othernode=a[0];this.lastlastnode=a[0];this.last3node=null;this.firsttocheck=1;this.sort1=function(a,b){return a.index<=b.index};this.sort2=function(a,b){return a.index>=b.index};this.sortdist=function(a){return function(b,k){return dist2(b,a)-dist2(k,a)}};this.fdraw=A;this.collisionmargin=
1E-4;this.iter=function(a,b,k){for(var e=this.lastindex,g=this.nodes,n=this.sides,t=[],p=0;p<k;p++)if(-1<e){var d=this.lastnode,c=this.othernode,l=this.lastlastnode,h=this.last3node,q=lcircular(x,e),w=new Circle(d.x,d.y,d.r+2.1*q),u=lcircular(n,g.length),m=lcircular(n,g.length-1),v=!1;if(u!=m||1==e)c=l;if(null!=this.othernode){m=[u,-u];for(var r=0;r<m.length;r++){var f=circles2tangent(d,"OUT",c,"OUT",q,m[r]);if(!isNan(f.x)&&!checkcollisionquadtree(a,f,this.collisionmargin)){g.push(f);f.retouch=!1;
f.notfound=!1;f.index=g.length;f.colorindex=d.colorindex+1;this.nodes=g;this.last3node=this.lastlastnode;this.lastlastnode=this.lastnode;this.lastnode=f;this.othernode=c;this.othernode.retouch=!0;insertquadtree(a,f);this.fdraw(b,this,e);v=!0;t.push(f);break}}}if(0==v)for(m=this.sortdist(d),w=collidings(a,w,this.collisionmargin).filter(function(a){return!(a==l||a==h)}).sort(m),c=0;c<w.length;c++){r=w[c];if(d!=r){m=[u,-u];for(var y=0;y<m.length;y++)if(f=circles2tangent(d,"OUT",r,"OUT",q,m[y]),!isNaN(f.x)&&
!checkcollisionquadtree(a,f,this.collisionmargin)){f.retouch=!1;f.notfound=!1;f.index=g.length;f.colorindex=d.colorindex+1;g.push(f);this.nodes=g;this.last3node=this.lastlastnode;this.lastlastnode=this.lastnode;this.lastnode=f;this.othernode=r;this.othernode.retouch=!0;insertquadtree(a,f);this.fdraw(b,this,e);v=!0;t.push(f);break}}if(v)break}if(v)e=g.length-1;else{d=g[e];for(d.notfound=!0;(d.retouch||d.notfound)&&0<e;)--e,d=g[e];this.lastnode=g[e];this.lastlastnode=g[e-1];this.othernode=null}this.lastindex=
e}return t}};
